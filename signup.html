<!DOCTYPE html>
<html>
	<head>
		<title>GFA World Perspectives Symposium</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />

		<!-- Polyfill support -->
		<script src="/bower_components/webcomponentsjs/webcomponents.min.js"></script>

		<link rel="stylesheet" href="/css/signup.css" />
		<!-- <link rel="import" href="/bower_components/core-animated-pages/core-animated-pages.html" /> -->
		<!-- <link rel="import" href="/components/schedule-chooser.html" /> -->
		<link rel="import" href="/bower_components/core-toolbar/core-toolbar.html" />
		<link rel="import" href="/bower_components/core-icons/core-icons.html" />
		<link rel="import" href="/bower_components/core-ajax/core-ajax.html" />
		<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html" />
		<link rel="import" href="/bower_components/paper-button/paper-button.html" />
		<link rel="import" href="/bower_components/paper-shadow/paper-shadow.html" />
		<link rel="import" href="/bower_components/paper-item/paper-item.html" />
		<link rel="import" href="/bower_components/core-animated-pages/core-animated-pages.html" />
		<!-- <link rel="import" href="/components/slide-animation.html" /> -->
		<link rel="import" href="/bower_components/core-animated-pages/transitions/slide-from-right.html" />
		<link rel="import" href="/bower_components/paper-progress/paper-progress.html" />
		<link rel="import" href="/components/content-panel.html" />
		<link rel="import" href="/components/session-list.html" />
		<script src="/socket.io/socket.io.js"></script>
	</head>
	<body unresolved>
		<core-ajax id="info-ajax" url="{{infoURL}}" on-core-response="{{infoLoaded}}" handleAs="json"></core-ajax>
		<core-animated-pages transitions="slide-from-right">
			<content-panel headtitle="Welcome">
				<img src="/img/logo.svg" alt="WPP" />
				<h1>World Perspectives Symposium</h1>
				<h2>April 22nd, 2015</h2>
				<p>
					Registering for: <span id="name">Loading...</span>
				</p>
				<footer>
					<div horizontal layout>
						<span flex></span>
						<paper-button class="custom" forward id="0-forward">
							Next
							<core-icon icon="arrow-forward"></core-icon>
						</paper-button>
					</div>
				</footer>
			</content-panel>
			<content-panel headtitle="Panel Selection">
				<p class="no-margin">A panel is a large session with many presenters discussing a general topic</p>
				<p><strong>Please pick your first choice</strong></p>
				<session-list url="/sessions/panels" index="1" panel="true"></session-list>
				<footer>
					<div horizontal layout>
						<paper-button class="custom" backward id="1-backward">
							<core-icon icon="arrow-back"></core-icon>
							Back
						</paper-button>
						<span flex></span>
						<paper-button class="custom" forward disabled id="1-forward">
							Next
							<core-icon icon="arrow-forward"></core-icon>
						</paper-button>
					</div>
				</footer>
			</content-panel>
			<content-panel headtitle="Global Studies Session Selection">
				<p class="no-margin">This is a session with a single presenter on a specific global issue</p>
				<p><strong>Please pick your first choice</strong></p>
				<session-list url="/sessions/wpp" index="2"></session-list>
				<footer>
					<div horizontal layout>
						<paper-button class="custom" backward id="2-backward">
							<core-icon icon="arrow-back"></core-icon>
							Back
						</paper-button>
						<span flex></span>
						<paper-button class="custom" forward disabled id="2-forward">
							Next
							<core-icon icon="arrow-forward"></core-icon>
						</paper-button>
					</div>
				</footer>
			</content-panel>
			<content-panel headtitle="Science Session Selection">
				<p class="no-margin">This is a session with a single presenter on scientific research that the presenter has performed</p>
				<p><strong>Please pick your first choice</strong></p>
				<session-list url="/sessions/science" index="3"></session-list>
				<footer>
					<div horizontal layout>
						<paper-button class="custom" backward id="3-backward">
							<core-icon icon="arrow-back"></core-icon>
							Back
						</paper-button>
						<span flex></span>
						<paper-button class="custom" forward disabled id="3-forward">
							Next
							<core-icon icon="arrow-forward"></core-icon>
						</paper-button>
					</div>
				</footer>
			</content-panel>
		</core-animated-pages>
		<paper-progress></paper-progress>
		<script>
			var user = {};
			document.addEventListener("DOMContentLoaded", function() {
				// Retrieve the user's information from #info-ajax
				var infoAJAX = document.getElementById("info-ajax");
				infoAJAX.url = "/info/" + window.location.pathname.split("/").pop();
				infoAJAX.addEventListener("core-response", function() {
					user = infoAJAX.response;
					// Set the user's name in the panel
					document.getElementById("name").textContent = user.name;
				});
				infoAJAX.go();
			});

			var progressController = document.querySelector("core-animated-pages");
			var progressDisplay = document.querySelector("paper-progress");
			var paperButtons = document.querySelectorAll("paper-button");
			var numberOfPanels = document.querySelectorAll("content-panel").length;
			for (var i = 0; i < paperButtons.length; i++) {
				paperButtons[i].onclick = function() {
					if (this.attributes.backward) {
						window.scrollTo(0, 0);
						progressController.selected--;
					}
					else if (this.attributes.forward) {
						window.scrollTo(0, 0);
						progressController.selected++;
					}
					checkBounds();
				};
			}
			var transitioning = false;
			document.addEventListener("keydown", function(e) {
				if (transitioning)
					return;
				if (e.keyCode === 39) {
					// Right key
					// Check if progression is allowed
					var buttons = document.querySelectorAll("paper-button");
					for (var i = 0, len = buttons.length; i < len; i++) {
						if (buttons[i].id === progressController.selected + "-forward" && !buttons[i].disabled) {
							window.scrollTo(0, 0);
							progressController.selected++;
							transitioning = checkBounds();
							break;
						}
					}
				}
				else if (e.keyCode === 37) {
					// Left key
					window.scrollTo(0, 0);
					progressController.selected--;
					transitioning = checkBounds();
				}
			});
			progressController.addEventListener("core-animated-pages-transition-end", function() {
				transitioning = false;
			});
			progressController.addEventListener("core-animated-pages-transition-prepare", function() {
				progressDisplay.value = (progressController.selected / (numberOfPanels - 1)) * 100;
			});
			function checkBounds() {
				if (progressController.selected < 0) {
					progressController.selected = 0;
					return false;
				}
				if (progressController.selected >= numberOfPanels) {
					progressController.selected = numberOfPanels - 1;
					return false;
				}
				return true;
			}

			// WebSocket connection to update session availability in real-time
			var socket = io.connect("/");
			socket.on("availability", function (data) {
				console.log(data);
				//socket.emit("my other event", { my: "data" });
			});
		</script>
	</body>
</html>